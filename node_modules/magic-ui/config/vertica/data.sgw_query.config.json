{
  "module": "m2",
  "flag": "vertical",
  "configs": [
    {
      "key": "query_sgw",
      "desc":"详细列表",
      "config": {
        "parameters": [
          {
            "name": "p_en",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c0",
            "symbol":""
          }
        ],
        "value": "SELECT     SGW_IP_Add,     CategoryName,     App_Type,     PoorQualityType,     round(DLrate,2.0) dlrate,     round(responddelay,2.0) responddelay,    round( RequsetSuccessRate,2.0) RequsetSuccessRate,     usernumber,     round(TotalFlow/1024,2.0) as totalflow,     round(dlrate_500k,2.0) dlrate_500k,     requestcount_500k,     round(flow_500k/1024,2.0) as flow_500k,     round(flowrate_500,2.0) as flowrate_500 FROM     LTE_SYS.[@c0]_T_End_TO_End_Analysis_SGW_PoorQuality"
      }
    },
    {
      "key": "query_sgw_p_en",
      "desc":"详细列表",
      "config": {
        "parameters": [
          {
            "name": "p_en",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c0",
            "symbol":""
          }
        , {
            "name": "starttime",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c1",
            "symbol":""
          }, {
            "name": "endtime",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c2",
            "symbol":""
          }, {
            "name": "province",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c3",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data1",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t1",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data2",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t2",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data3",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t3",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data4",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t4",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data5",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t5",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data6",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t6",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data7",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t7",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data8",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t8",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data9",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t9",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data10",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t10",
            "symbol":""
          }
        ],
        "value": "SELECT             *         FROM             (                 SELECT                     spc.SGW_IP_Add,                     spc.app_type,                     type.categoryname,                     type.appsubtypename,                     spc.PoorQualityType,                     spc.DLrate ,                     spc.responddelay,                     spc.RequsetSuccessRate,                     spc.usernumber,                     spc.DLData ,                     CASE                         WHEN spc.dlrate_500k<2048                         AND spc.PoorQualityType='速率'                         THEN dlrate_500k                         WHEN spc.PoorQualityType='成功率'                         THEN dlrate_500k                         WHEN spc.PoorQualityType='时延'                         THEN dlrate_500k                     END                              dlrate_500k,                     ROUND(spc.requestcount_500k,4.0) requestcount_500k,                     spc.flow_500k,                     ROUND(spc.flowrate_500,4.0) flowrate_500                 FROM                     (                         SELECT                             c.SGW_IP_Add,                             app_type,                             App_Sub_Type,                             c.sp1                                                AS PoorQualityType,                             ROUND(SUM(DLData)*8*1000/SUM(Businesshours)/1024,2.0)    DLrate,                             ROUND(SUM(responddelay)/SUM(responddelaycount),2.0)   AS responddelay,                             ROUND(SUM(RequestSuccsessCount)/SUM(RequestCount),4.0)*100                                               RequsetSuccessRate,                             SUM(RequestCount) usernumber,                             SUM(DLData)       DLData,                             ROUND(                                 CASE                                     WHEN (SUM(DLData_500K) IS NULL                                         OR  SUM(DLData_500K)=0                                         OR  SUM(Businesshours_500K) IS NULL                                         OR  SUM(Businesshours_500K)=0)                                     THEN 0                                     ELSE SUM(DLData_500K)*8*1000/SUM(Businesshours_500K)/1024                                 END,2.0) AS Dlrate_500k,                             CASE                                 WHEN SUM(RequestCount_500) IS NULL                                 THEN 0                                 ELSE SUM(RequestCount_500)                             END AS requestcount_500k,                             SUM(                                 CASE                                     WHEN DLData_500K IS NULL                                     THEN 0                                     ELSE DLData_500K                                 END) AS flow_500k,                             (                                 CASE                                     WHEN SUM(dldata) IS NULL                                     OR  SUM(dldata)=0                                     OR  SUM(DLData_500K) IS NULL                                     OR  SUM(DLData_500K)=0                                     THEN 0                                     ELSE SUM(DLData_500K)/SUM(DLData)*100                                 END) AS flowrate_500                         FROM                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW sp                         RIGHT JOIN                             (                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp1                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '速率' AS sp1,                                                     ROUND(SUM(DLData_500K)*8*1000/SUM                                                     (Businesshours_500K)/1024,2.0) AS                                                                              Serverspeedavg,                                                     SUM(RequestCount_500) AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             DLData_500K>[@t7]                                         AND StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                 GROUP BY                                                     SGW_IP_Add) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             SGW_IP_Add,                                                             App_Type,                                                             ROUND(SUM(DLData_500K)*8*1000/SUM                                                             (Businesshours_500K)/ 1024,2.0) AS Serverspeedavg,                                                             SUM(RequestCount_500) AS XDRcounta                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     DLData_500K>[@t7]                                                 AND StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                         GROUP BY                                                             SGW_IP_Add,                                                             App_Type) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             ROUND(SUM(DLData_500K)*8*1000/SUM                                                             (Businesshours_500K)/ 1024,2.0) AS Serverspeedavg                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     DLData_500K>[@t7]                                                 AND StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                             a.XDRcounta>[@t8]                                         AND a.Serverspeedavg<b.Serverspeedavg*[@t9]                                                 GROUP BY                                                     SGW_IP_Add                                                     ) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add)test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                          FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount_500) AS XDRcountb                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             DLData_500K>[@t7]                                         AND StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                                                                   SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t8]                                         GROUP BY                                             test3.SGW_IP_Add                                             )test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t10] AND test5.count2>5                                  UNION ALL                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp2                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '时延'                                     AS sp2,                                                     SUM(responddelay)/SUM(responddelaycount) AS                                                                          repsdelay,                                                     SUM(RequestCount) AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     SGW_IP_Add                                                    ) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             App_Type,                                                             SGW_IP_Add,                                                             SUM(responddelay)/SUM(responddelaycount                                                             )                 AS repsdelay,                                                             SUM(RequestCount) AS XDRcounta                                                         FROM                                                            lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type,                                                             SGW_IP_Add ) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             SUM(responddelay)/SUM(responddelaycount                                                             ) AS repsdelay                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                  GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                                     a.XDRcounta>[@t1]                                         AND a.repsdelay*[@t2]>b.repsdelay                                                 GROUP BY                                                     SGW_IP_Add                                                    ) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add)test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                         FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount) AS XDRcountb                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                     SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t1]                                         GROUP BY                                             test3.SGW_IP_Add                                             )test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t3] AND test5.count2>5                                  UNION ALL                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp3                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '成功率' AS sp3,                                                     ROUND(SUM(RequestSuccsessCount)/SUM                                                     (RequestCount)*100 ,2.0) AS Requestsucess ,                                                     SUM(RequestCount)        AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     SGW_IP_Add                                                   ) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             App_Type,                                                             SGW_IP_Add,                                                             ROUND(SUM(RequestSuccsessCount)/SUM                                                             (RequestCount),2.0) AS Requestsucess,                                                             SUM(RequestCount)   AS XDRcounta                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type,                                                             SGW_IP_Add ) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             ROUND(SUM(RequestSuccsessCount)/SUM                                                             (RequestCount),2.0) AS Requestsucess                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                         GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                                    a.XDRcounta>[@t4]                                         AND b.Requestsucess-a.Requestsucess>[@t5]                                                 GROUP BY                                                     SGW_IP_Add) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add) test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                         FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount) AS XDRcountb                                                 FROM                                                    lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                                                                        SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t4]                                         GROUP BY                                             test3.SGW_IP_Add)test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t6] AND test5.count2>5                                          )c                         ON                             c.SGW_IP_Add=sp.SGW_IP_Add                             AND sp.StartTime>=TIMESTAMP'[@c1]'                 AND sp.StartTime<=TIMESTAMP'[@c2]'                         GROUP BY                             c.SGW_IP_Add,                              app_type,                             App_Sub_Type,                             c.sp1)spc                             inner join                              (select categoryid,categoryname,bussinessname as appsubtypename,bussinessid,city.cityname from lte_sys.[@c0]_t_base_categorytype t                             inner join lte_sys.t_base_city city on t.city_no=city.city_no                             )type on spc.App_Type=type.categoryid and spc.App_Type||'-'||spc.App_Sub_Type=type.bussinessid                 )t         WHERE             t.dlrate_500k IS NOT NULL order by SGW_IP_Add    "
      }
    },
    {
      "key": "query_sgw_leftchar",
      "desc":"左边饼图",
      "config": {
        "parameters": [
          {
            "name": "p_en",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c0",
            "symbol":""
          }
        ],
        "value": "select (select count(distinct SGW_IP_Add) from lte_sys.[@c0]_T_END_TO_END_ANALYSIS_SGW) as count1,(select count(distinct SGW_IP_Add) from lte_sys.[@c0]_T_End_TO_End_Analysis_SGW_PoorQuality) as count2 from dual"
      }
    },
    {
      "key": "query_sgw_leftchar_p_en",
      "desc":"左边饼图",
      "config": {
        "parameters": [
          {
            "name": "p_en",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c0",
            "symbol":""
          }
        , {
            "name": "starttime",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c1",
            "symbol":""
          }, {
            "name": "endtime",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c2",
            "symbol":""
          }, {
            "name": "province",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c3",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data1",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t1",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data2",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t2",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data3",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t3",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data4",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t4",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data5",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t5",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data6",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t6",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data7",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t7",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data8",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t8",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data9",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t9",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data10",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t10",
            "symbol":""
          }
        ],
        "value": "with tmp as (SELECT             *         FROM             (                 SELECT                     spc.SGW_IP_Add,                     spc.app_type,                     type.categoryname,                     type.appsubtypename,                     spc.PoorQualityType,                     spc.DLrate ,                     spc.responddelay,                     spc.RequsetSuccessRate,                     spc.usernumber,                     spc.DLData ,                     CASE                         WHEN spc.dlrate_500k<2048                         AND spc.PoorQualityType='速率'                         THEN dlrate_500k                         WHEN spc.PoorQualityType='成功率'                         THEN dlrate_500k                         WHEN spc.PoorQualityType='时延'                         THEN dlrate_500k                     END                              dlrate_500k,                     ROUND(spc.requestcount_500k,4.0) requestcount_500k,                     spc.flow_500k,                     ROUND(spc.flowrate_500,4.0) flowrate_500                 FROM                     (                         SELECT                             c.SGW_IP_Add,                             app_type,                             App_Sub_Type,                             c.sp1                                                AS PoorQualityType,                             ROUND(SUM(DLData)*8*1000/SUM(Businesshours)/1024,2.0)    DLrate,                             ROUND(SUM(responddelay)/SUM(responddelaycount),2.0)   AS responddelay,                             ROUND(SUM(RequestSuccsessCount)/SUM(RequestCount),4.0)*100                                               RequsetSuccessRate,                             SUM(RequestCount) usernumber,                             SUM(DLData)       DLData,                             ROUND(                                 CASE                                     WHEN (SUM(DLData_500K) IS NULL                                         OR  SUM(DLData_500K)=0                                         OR  SUM(Businesshours_500K) IS NULL                                         OR  SUM(Businesshours_500K)=0)                                     THEN 0                                     ELSE SUM(DLData_500K)*8*1000/SUM(Businesshours_500K)/1024                                 END,2.0) AS Dlrate_500k,                             CASE                                 WHEN SUM(RequestCount_500) IS NULL                                 THEN 0                                 ELSE SUM(RequestCount_500)                             END AS requestcount_500k,                             SUM(                                 CASE                                     WHEN DLData_500K IS NULL                                     THEN 0                                     ELSE DLData_500K                                 END) AS flow_500k,                             (                                 CASE                                     WHEN SUM(dldata) IS NULL                                     OR  SUM(dldata)=0                                     OR  SUM(DLData_500K) IS NULL                                     OR  SUM(DLData_500K)=0                                     THEN 0                                     ELSE SUM(DLData_500K)/SUM(DLData)*100                                 END) AS flowrate_500                         FROM                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW sp                         RIGHT JOIN                             (                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp1                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '速率' AS sp1,                                                     ROUND(SUM(DLData_500K)*8*1000/SUM                                                     (Businesshours_500K)/1024,2.0) AS                                                                              Serverspeedavg,                                                     SUM(RequestCount_500) AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             DLData_500K>[@t7]                                         AND StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                 GROUP BY                                                     SGW_IP_Add) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             SGW_IP_Add,                                                             App_Type,                                                             ROUND(SUM(DLData_500K)*8*1000/SUM                                                             (Businesshours_500K)/ 1024,2.0) AS Serverspeedavg,                                                             SUM(RequestCount_500) AS XDRcounta                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     DLData_500K>[@t7]                                                 AND StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                         GROUP BY                                                             SGW_IP_Add,                                                             App_Type) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             ROUND(SUM(DLData_500K)*8*1000/SUM                                                             (Businesshours_500K)/ 1024,2.0) AS Serverspeedavg                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     DLData_500K>[@t7]                                                 AND StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                             a.XDRcounta>[@t8]                                         AND a.Serverspeedavg<b.Serverspeedavg*[@t9]                                                 GROUP BY                                                     SGW_IP_Add                                                     ) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add)test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                          FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount_500) AS XDRcountb                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             DLData_500K>[@t7]                                         AND StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                                                                   SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t8]                                         GROUP BY                                             test3.SGW_IP_Add                                             )test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t10] AND test5.count2>5                                  UNION ALL                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp2                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '时延'                                     AS sp2,                                                     SUM(responddelay)/SUM(responddelaycount) AS                                                                          repsdelay,                                                     SUM(RequestCount) AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     SGW_IP_Add                                                    ) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             App_Type,                                                             SGW_IP_Add,                                                             SUM(responddelay)/SUM(responddelaycount                                                             )                 AS repsdelay,                                                             SUM(RequestCount) AS XDRcounta                                                         FROM                                                            lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type,                                                             SGW_IP_Add ) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             SUM(responddelay)/SUM(responddelaycount                                                             ) AS repsdelay                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                  GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                                     a.XDRcounta>[@t1]                                         AND a.repsdelay*[@t2]>b.repsdelay                                                 GROUP BY                                                     SGW_IP_Add                                                    ) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add)test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                         FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount) AS XDRcountb                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                     SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t1]                                         GROUP BY                                             test3.SGW_IP_Add                                             )test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t3] AND test5.count2>5                                  UNION ALL                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp3                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '成功率' AS sp3,                                                     ROUND(SUM(RequestSuccsessCount)/SUM                                                     (RequestCount)*100 ,2.0) AS Requestsucess ,                                                     SUM(RequestCount)        AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     SGW_IP_Add                                                   ) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             App_Type,                                                             SGW_IP_Add,                                                             ROUND(SUM(RequestSuccsessCount)/SUM                                                             (RequestCount),2.0) AS Requestsucess,                                                             SUM(RequestCount)   AS XDRcounta                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type,                                                             SGW_IP_Add ) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             ROUND(SUM(RequestSuccsessCount)/SUM                                                             (RequestCount),2.0) AS Requestsucess                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                         GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                                    a.XDRcounta>[@t4]                                         AND b.Requestsucess-a.Requestsucess>[@t5]                                                 GROUP BY                                                     SGW_IP_Add) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add) test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                         FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount) AS XDRcountb                                                 FROM                                                    lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                                                                        SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t4]                                         GROUP BY                                             test3.SGW_IP_Add)test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t6] AND test5.count2>5                                          )c                         ON                             c.SGW_IP_Add=sp.SGW_IP_Add                             AND sp.StartTime>=TIMESTAMP'[@c1]'                 AND sp.StartTime<=TIMESTAMP'[@c2]'                         GROUP BY                             c.SGW_IP_Add,                              app_type,                             App_Sub_Type,                             c.sp1)spc                             inner join                              (select categoryid,categoryname,bussinessname as appsubtypename,bussinessid,city.cityname from lte_sys.[@c0]_t_base_categorytype t                             inner join lte_sys.t_base_city city on t.city_no=city.city_no                             )type on spc.App_Type=type.categoryid and spc.App_Type||'-'||spc.App_Sub_Type=type.bussinessid                 )t         WHERE             t.dlrate_500k IS NOT NULL order by SGW_IP_Add   )      SELECT     (         SELECT             COUNT(DISTINCT SGW_IP_Add)         FROM             lte_sys.[@c0]_T_END_TO_END_ANALYSIS_SGW) AS count1,     (         SELECT             COUNT(DISTINCT SGW_IP_Add)         FROM             tmp) AS count2 FROM     dual"
      }
    },
    {
      "key": "query_sgw_rightchar",
      "desc":"右边和弦图",
      "config": {
        "parameters": [
          {
            "name": "p_en",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c0",
            "symbol":""
          }
        ],
        "value": "select * from (SELECT DISTINCT sgw_ip_add, poorqualitytype, SUM(USERNUMBER) AS USERNUMBER FROM lte_sys.[@c0]_T_End_TO_End_Analysis_SGW_PoorQuality   GROUP BY SGW_IP_ADD,POORQUALITYTYPE order by usernumber desc limit 15)t"
      }
    },
    {
      "key": "query_sgw_rightchar_p_en",
      "desc":"右边和弦图",
      "config": {
        "parameters": [
          {
            "name": "p_en",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c0",
            "symbol":""
          }
        , {
            "name": "starttime",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c1",
            "symbol":""
          }, {
            "name": "endtime",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c2",
            "symbol":""
          }, {
            "name": "province",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "c3",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data1",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t1",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data2",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t2",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data3",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t3",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data4",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t4",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data5",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t5",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data6",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t6",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data7",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t7",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data8",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t8",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data9",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t9",
            "symbol":""
          },
          {
            "name": "sgw_Threshold_data10",
            "columnname": "",
            "type":"string",
            "format": "",
            "conditionid": "t10",
            "symbol":""
          }
        ],
        "value": "WITH     tmp AS     (SELECT             *         FROM             (                 SELECT                     spc.SGW_IP_Add,                     spc.app_type,                     type.categoryname,                     type.appsubtypename,                     spc.PoorQualityType,                     spc.DLrate ,                     spc.responddelay,                     spc.RequsetSuccessRate,                     spc.usernumber,                     spc.DLData ,                     CASE                         WHEN spc.dlrate_500k<2048                         AND spc.PoorQualityType='速率'                         THEN dlrate_500k                         WHEN spc.PoorQualityType='成功率'                         THEN dlrate_500k                         WHEN spc.PoorQualityType='时延'                         THEN dlrate_500k                     END                              dlrate_500k,                     ROUND(spc.requestcount_500k,4.0) requestcount_500k,                     spc.flow_500k,                     ROUND(spc.flowrate_500,4.0) flowrate_500                 FROM                     (                         SELECT                             c.SGW_IP_Add,                             app_type,                             App_Sub_Type,                             c.sp1                                                AS PoorQualityType,                             ROUND(SUM(DLData)*8*1000/SUM(Businesshours)/1024,2.0)    DLrate,                             ROUND(SUM(responddelay)/SUM(responddelaycount),2.0)   AS responddelay,                             ROUND(SUM(RequestSuccsessCount)/SUM(RequestCount),4.0)*100                                               RequsetSuccessRate,                             SUM(RequestCount) usernumber,                             SUM(DLData)       DLData,                             ROUND(                                 CASE                                     WHEN (SUM(DLData_500K) IS NULL                                         OR  SUM(DLData_500K)=0                                         OR  SUM(Businesshours_500K) IS NULL                                         OR  SUM(Businesshours_500K)=0)                                     THEN 0                                     ELSE SUM(DLData_500K)*8*1000/SUM(Businesshours_500K)/1024                                 END,2.0) AS Dlrate_500k,                             CASE                                 WHEN SUM(RequestCount_500) IS NULL                                 THEN 0                                 ELSE SUM(RequestCount_500)                             END AS requestcount_500k,                             SUM(                                 CASE                                     WHEN DLData_500K IS NULL                                     THEN 0                                     ELSE DLData_500K                                 END) AS flow_500k,                             (                                 CASE                                     WHEN SUM(dldata) IS NULL                                     OR  SUM(dldata)=0                                     OR  SUM(DLData_500K) IS NULL                                     OR  SUM(DLData_500K)=0                                     THEN 0                                     ELSE SUM(DLData_500K)/SUM(DLData)*100                                 END) AS flowrate_500                         FROM                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW sp                         RIGHT JOIN                             (                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp1                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '速率' AS sp1,                                                     ROUND(SUM(DLData_500K)*8*1000/SUM                                                     (Businesshours_500K)/1024,2.0) AS                                                                              Serverspeedavg,                                                     SUM(RequestCount_500) AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             DLData_500K>[@t7]                                         AND StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                 GROUP BY                                                     SGW_IP_Add) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             SGW_IP_Add,                                                             App_Type,                                                             ROUND(SUM(DLData_500K)*8*1000/SUM                                                             (Businesshours_500K)/ 1024,2.0) AS Serverspeedavg,                                                             SUM(RequestCount_500) AS XDRcounta                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     DLData_500K>[@t7]                                                 AND StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                         GROUP BY                                                             SGW_IP_Add,                                                             App_Type) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             ROUND(SUM(DLData_500K)*8*1000/SUM                                                             (Businesshours_500K)/ 1024,2.0) AS Serverspeedavg                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     DLData_500K>[@t7]                                                 AND StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                             a.XDRcounta>[@t8]                                         AND a.Serverspeedavg<b.Serverspeedavg*[@t9]                                                 GROUP BY                                                     SGW_IP_Add                                                     ) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add)test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                          FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount_500) AS XDRcountb                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             DLData_500K>[@t7]                                         AND StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                                                                   SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t8]                                         GROUP BY                                             test3.SGW_IP_Add                                             )test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t10] AND test5.count2>5                                  UNION ALL                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp2                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '时延'                                     AS sp2,                                                     SUM(responddelay)/SUM(responddelaycount) AS                                                                          repsdelay,                                                     SUM(RequestCount) AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     SGW_IP_Add                                                    ) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             App_Type,                                                             SGW_IP_Add,                                                             SUM(responddelay)/SUM(responddelaycount                                                             )                 AS repsdelay,                                                             SUM(RequestCount) AS XDRcounta                                                         FROM                                                            lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type,                                                             SGW_IP_Add ) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             SUM(responddelay)/SUM(responddelaycount                                                             ) AS repsdelay                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                  GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                                     a.XDRcounta>[@t1]                                         AND a.repsdelay*[@t2]>b.repsdelay                                                 GROUP BY                                                     SGW_IP_Add                                                    ) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add)test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                         FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount) AS XDRcountb                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                     SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t1]                                         GROUP BY                                             test3.SGW_IP_Add                                             )test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t3] AND test5.count2>5                                  UNION ALL                                 SELECT                                     test4.SGW_IP_Add,                                     test4.sp3                                 FROM                                     (                                         SELECT                                             test1.*,                                             test2.count1                                         FROM                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     '成功率' AS sp3,                                                     ROUND(SUM(RequestSuccsessCount)/SUM                                                     (RequestCount)*100 ,2.0) AS Requestsucess ,                                                     SUM(RequestCount)        AS XDRcount                                                 FROM                                                     lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     SGW_IP_Add                                                   ) test1                                         LEFT JOIN                                             (                                                 SELECT                                                     SGW_IP_Add,                                                     COUNT (*) AS count1                                                 FROM                                                     (                                                         SELECT                                                             App_Type,                                                             SGW_IP_Add,                                                             ROUND(SUM(RequestSuccsessCount)/SUM                                                             (RequestCount),2.0) AS Requestsucess,                                                             SUM(RequestCount)   AS XDRcounta                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                                                                                   GROUP BY                                                             App_Type,                                                             SGW_IP_Add ) a                                                 LEFT JOIN                                                     (                                                         SELECT                                                             App_Type,                                                             ROUND(SUM(RequestSuccsessCount)/SUM                                                             (RequestCount),2.0) AS Requestsucess                                                         FROM                                                             lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                                 WHERE                                                     StartTime>=TIMESTAMP'[@c1]'                                                 AND StartTime<=TIMESTAMP'[@c2]'                                                         GROUP BY                                                             App_Type) b                                                 ON                                                     a.App_Type = b.App_Type                                                 WHERE                                                    a.XDRcounta>[@t4]                                         AND b.Requestsucess-a.Requestsucess>[@t5]                                                 GROUP BY                                                     SGW_IP_Add) test2                                         ON                                             test1.SGW_IP_Add=test2.SGW_IP_Add) test4                                 LEFT JOIN                                     (                                         SELECT                                             test3.SGW_IP_Add,                                             COUNT(*) AS count2                                         FROM                                             (                                                 SELECT                                                     App_Type,                                                     SGW_IP_Add,                                                     SUM(RequestCount) AS XDRcountb                                                 FROM                                                    lte_sys.[@c0]_T_End_TO_End_Analysis_SGW                                         WHERE                                             StartTime>=TIMESTAMP'[@c1]'                                         AND StartTime<=TIMESTAMP'[@c2]'                                                                                                  GROUP BY                                                     App_Type,                                                                                                        SGW_IP_Add) test3                                         WHERE                                             test3.XDRcountb>[@t4]                                         GROUP BY                                             test3.SGW_IP_Add)test5                                 ON                                     test4.SGW_IP_Add=test5.SGW_IP_Add                                 WHERE                                     (test4.count1/test5.count2)>[@t6] AND test5.count2>5                                          )c                         ON                             c.SGW_IP_Add=sp.SGW_IP_Add                             AND sp.StartTime>=TIMESTAMP'[@c1]'                 AND sp.StartTime<=TIMESTAMP'[@c2]'                         GROUP BY                             c.SGW_IP_Add,                              app_type,                             App_Sub_Type,                             c.sp1)spc                             inner join                              (select categoryid,categoryname,bussinessname as appsubtypename,bussinessid,city.cityname from lte_sys.[@c0]_t_base_categorytype t                             inner join lte_sys.t_base_city city on t.city_no=city.city_no                             )type on spc.App_Type=type.categoryid and spc.App_Type||'-'||spc.App_Sub_Type=type.bussinessid                 )t         WHERE             t.dlrate_500k IS NOT NULL order by SGW_IP_Add   ) SELECT     * FROM     (         SELECT DISTINCT             sgw_ip_add,             poorqualitytype,             SUM(USERNUMBER) AS USERNUMBER         FROM             tmp         GROUP BY             SGW_IP_ADD,             POORQUALITYTYPE         ORDER BY             usernumber DESC limit 15)t"
      }
    }
  ]
}